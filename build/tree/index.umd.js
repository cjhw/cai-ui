(function(C,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(C=typeof globalThis<"u"?globalThis:C||self,t(C.index={},C.Vue))})(this,function(C,t){"use strict";function V(n,e=0,a=[]){return e++,n.reduce((c,o)=>{var l;const r={...o};if(r.level=e,a.length>0&&a[a.length-1].level>=e)for(;((l=a[a.length-1])==null?void 0:l.level)>=e;)a.pop();a.push(r);const i=a[a.length-2];if(i&&(r.parentId=i.id),r.children){const d=V(r.children,e,a);return delete r.children,c.concat(r,d)}else return r.isLeaf===void 0&&(r.isLeaf=!0),c.concat(r)},[])}function H(n,{getChildren:e}){return{toggleCheckNode:c=>{c.checked=!c.checked,e(c).forEach(l=>{l.checked=c.checked});const o=n.value.find(l=>l.id===c.parentId);if(!o)return;const r=e(o,!1),i=r.filter(l=>l.checked);i.length===r.length?o.checked=!0:i.length===0&&(o.checked=!1)}}}function z(n){const e=t.computed(()=>{let l=[];const d=[];for(const p of n.value)l.map(s=>s.id).includes(p.id)||(p.expanded!==!0&&(l=a(p)),d.push(p));return d}),a=(l,d=!0)=>{const p=[],s=n.value.findIndex(v=>v.id===l.id);for(let v=s+1;v<n.value.length&&l.level<n.value[v].level;v++)(d||l.level===n.value[v].level-1)&&p.push(n.value[v]);return p},c=(l,d=[])=>{const p=a(l,!1);return d.push(...p),p.forEach(s=>{s.expanded&&c(s,d)}),d};return{expendedTree:e,getChildren:a,getChildrenExpanded:c,getIndex:l=>l?n.value.findIndex(d=>d.id===l.id):-1,getNode:l=>n.value.find(d=>d.id===l.id),getParent:l=>n.value.find(d=>d.id===l.parentId)}}function j(n=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let c=0;c<n;c++)a+=e[parseInt((Math.random()*e.length).toString())];return a}function B(n,{getChildren:e,getIndex:a}){return{append:(r,i)=>{const l=e(r,!1),d=l[l.length-1];let p=a(r)+1;d&&(p=a(d)+1),r.expanded=!0,r.isLeaf=!1;const s=t.ref({...i,level:r.level+1,parentId:r.id,isLeaf:!0});s.value.id===void 0&&(s.value.id=j()),n.value.splice(p,0,s.value)},remove:r=>{const i=e(r).map(l=>l.id);n.value=n.value.filter(l=>l.id!==r.id&&!i.includes(l.id))}}}function R(n,e,a,c){const{lazyLoadNodes:o}=c;return{toggleNode:i=>{const l=n.value.find(d=>d.id===i.id);l&&(l.expanded=!l.expanded,l.expanded&&o(l))}}}function $(n,{getNode:e,getIndex:a,getChildren:c},{emit:o}){const r=p=>{const s=e(p);s&&s.isLeaf===!1&&!s.childNodeCount&&(s.loading=!0,o("lazy-load",p,i))},i=p=>{const s=e(p.node);if(s){s.loading=!1;const v=t.ref(V(p.treeItems,s.level));l(s,v),d(s,v);const N=c(s);s.childNodeCount=N.length}},l=(p,s)=>{s.value.forEach(v=>{v.level-1===p.level&&!v.parentId&&(v.parentId=p.id)})},d=(p,s)=>{const v=a(p);v&&n.value.splice(v+1,0,...s.value)};return{lazyLoadNodes:r}}const k={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function q(n,e,{getChildren:a,getParent:c}){const o=t.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),r=t.computed(()=>e.value.reduce((u,f)=>({...u,[f.id]:f}),{})),i=u=>{u==null||u.classList.remove(...Object.values(k))},l=(u,f)=>{var h;const g=(h=r.value[u])==null?void 0:h.parentId;return g===f?!0:g!==void 0?l(g,f):!1},d=()=>{o.dropType=void 0,o.draggingNode=null,o.draggingTreeNode=null},p=(u,f)=>{var g;u.stopPropagation(),o.draggingNode=u.target,o.draggingTreeNode=f,(g=u.dataTransfer)==null||g.setData("dragNodeId",f.id)},s=u=>{if(u.preventDefault(),u.stopPropagation(),!!o.draggingNode&&n){if(u.dataTransfer&&(u.dataTransfer.dropEffect="move"),!e)return;let f={};typeof n=="object"?f=n:n===!0&&(f={dropInner:!0});const{dropPrev:g,dropNext:h,dropInner:x}=f;let m;const T=g?x?.25:h?.45:1:-1,L=h?x?.75:g?.55:0:1,y=u.currentTarget,b=y==null?void 0:y.getBoundingClientRect(),S=u.clientY-((b==null?void 0:b.top)||0);if(S<((b==null?void 0:b.height)||0)*T?m="dropPrev":S>((b==null?void 0:b.height)||0)*L?m="dropNext":x?m="dropInner":m=void 0,m){const D=y==null?void 0:y.classList;D&&(D.contains(k[m])||(i(y),D.add(k[m])))}else i(y);o.dropType=m}},v=u=>{u.stopPropagation(),o.draggingNode&&i(u.currentTarget)},N=(u,f)=>{var h;if(u.preventDefault(),u.stopPropagation(),i(u.currentTarget),!o.draggingNode||!n)return;const g=(h=u.dataTransfer)==null?void 0:h.getData("dragNodeId");if(g){const x=l(f.id,g);if(g===f.id||x)return;o.dropType&&I(g,f),d()}};function I(u,f){const g=e.value.find(h=>h.id===u);if(g){let h;const x=a(g),m=c(g);if(o.dropType==="dropInner"){h={...g,parentId:f.id,level:f.level+1};const T=e.value.indexOf(f);e.value.splice(T+1,0,h),f.isLeaf=void 0;const L=e.value.indexOf(g);e.value.splice(L,1)}else if(o.dropType==="dropNext"){h={...g,parentId:f.parentId,level:f.level};const T=e.value.indexOf(f),L=a(f,!0).length;e.value.splice(T+L+1,0,h);const y=e.value.indexOf(g);e.value.splice(y,1)}else if(o.dropType==="dropPrev"){h={...g,parentId:f.parentId,level:f.level};const T=e.value.indexOf(f);e.value.splice(T,0,h);const L=e.value.indexOf(g);e.value.splice(L,1)}o.dropType="dropInner",x.forEach(T=>I(T.id,h)),m&&a(m).length===0&&(m.isLeaf=!0)}}return{onDragstart:p,onDragover:s,onDragleave:v,onDrop:N,onDragend:u=>{u.preventDefault(),u.stopPropagation(),d()}}}function A(n,e,a){const c=t.unref(n),o=t.ref(V(c)),r=z(o),i=[R,H,B],l=$(o,r,a),d=q(e.dragdrop,o,r);return{...i.reduce((s,v)=>({...s,...v(o,r,a,l)}),{}),...r,...d,treeData:o}}const _={data:{type:Object,required:!0},checkable:{type:Boolean,default:!1},lineable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},dragdrop:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30}},G={..._,treeNode:{type:Object,required:!0}},O=32,E=24,F=t.defineComponent({name:"CTreeNode",props:G,setup(n,{slots:e}){const{lineable:a,checkable:c,treeNode:o,operable:r,dragdrop:i}=t.toRefs(n),{toggleCheckNode:l,getChildrenExpanded:d,append:p,remove:s,onDragend:v,onDragleave:N,onDragover:I,onDragstart:P,onDrop:u}=t.inject("TREE_UTILS"),f=t.ref(!1),g=()=>{f.value?f.value=!1:f.value=!0};let h={};return i.value&&(h={draggable:!0,onDragend:x=>v(x),onDragleave:x=>N(x),onDragover:x=>I(x),onDragstart:x=>P(x,o.value),onDrop:x=>u(x,o.value)}),()=>t.createVNode("div",{class:"relative leading-8 hover:bg-slate-300",style:{paddingLeft:`${E*(o.value.level-1)}px`},onMouseenter:g,onMouseleave:g},[!o.value.isLeaf&&o.value.expanded&&a.value&&t.createVNode("span",{class:"s-tree-node__vline absolute w-px bg-slate-300",style:{height:`${O*d(o.value).length}px`,left:`${E*(o.value.level-1)+12}px`,top:`${O}px`}},null),t.createVNode("div",t.mergeProps({class:"s-tree__node--content"},h),[o.value.isLeaf?t.createVNode("span",{style:{display:"inline-block",width:"25px"}},null):e.icon(),c.value&&t.withDirectives(t.createVNode("input",{type:"checkbox","onUpdate:modelValue":x=>o.value.checked=x,class:"relative top-[2px] mr-1",onClick:()=>{l(o.value)}},null),[[t.vModelCheckbox,o.value.checked]]),e.content(),r.value&&f.value&&t.createVNode("span",{class:"inline-flex ml-1"},[t.createVNode("svg",{onClick:()=>{p(o.value,{label:"\u65B0\u8282\u70B9"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[t.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),t.createVNode("svg",{onClick:()=>{s(o.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[t.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),o.value.loading&&e.loading()])])}}),U=(n,{emit:e})=>t.createVNode("svg",{style:{width:"25px",height:"16px",display:"inline-block",transform:n.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",onClick:()=>e("onClick")},[t.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),ne="",X={data:{type:Array,default:[]},itemHeight:{type:Number,default:22},component:{type:String,default:"div"}},te="",Y=t.defineComponent({name:"VirtualList",props:X,setup(n,{slots:e}){const{data:a,itemHeight:c,component:o}=t.toRefs(n),r=t.ref(),i=t.ref(0),l=t.ref(0),d=t.ref(0),p=t.computed(()=>Math.ceil(i.value/c.value)),s=t.computed(()=>a.value.slice(d.value,Math.min(d.value+p.value,a.value.length)));t.onMounted(()=>{var N;i.value=(N=r.value)==null?void 0:N.clientHeight});const v=function(N){const I=N.target.scrollTop;d.value=Math.floor(I/c.value),l.value=I-I%c.value};return()=>t.createVNode(o.value,{class:"s-virtual-list__container",ref:r,onScroll:v},{default:()=>[t.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${a.value.length*c.value}px`}},null),t.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0,${l.value}px,0)`}},[s.value.map((N,I)=>{var P;return(P=e.default)==null?void 0:P.call(e,{item:N,index:I})})])]})}}),J="s",M="_cai",K="C",Q=(n,e={classPrefix:J})=>{var a;n.config.globalProperties[M]={...(a=n.config.globalProperties[M])!=null?a:{},classPrefix:e.classPrefix}},W=n=>{var e;return(e=n==null?void 0:n.componentPrefix)!=null?e:K};function Z(n,e,a){const c=W(a);n.component(c+e.name)||(Q(n,a),n.component(c+e.name,e))}const w=t.defineComponent({name:"Tree",props:_,emits:["lazy-load"],setup(n,e){const{data:a,height:c,itemHeight:o}=t.toRefs(n),{slots:r}=e,i=A(a.value,n,e);return t.provide("TREE_UTILS",i),()=>{const l=d=>t.createVNode(F,t.mergeProps(n,{treeNode:d}),{content:()=>r.content?r.content(d):d.label,icon:()=>r.icon?r.icon({nodeData:d,toggleNode:i.toggleNode}):t.createVNode(U,{expanded:!!d.expanded,onClick:()=>i.toggleNode(d)},null),loading:()=>r.loading?r.loading({nodeData:i}):t.createVNode("span",{class:"ml-1"},[t.createTextVNode("loading...")])});return t.createVNode("div",{class:"s-tree"},[c!=null&&c.value?t.createVNode("div",{style:{height:`${c.value}px`}},[t.createVNode(Y,{data:i.expendedTree.value,itemHeight:o.value},{default:({item:d})=>l(d)})]):i.expendedTree.value.map(d=>l(d))])}}}),ee={install(n,e){Z(n,w,e)}};C.Tree=w,C.default=ee,Object.defineProperties(C,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
